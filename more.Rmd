---
title: "Fun Explorations"
output:
  html_document
---

```{r setup, include = FALSE}
library(tidyverse)
library(rvest)
library(dplyr)
library(patchwork)

theme_set(theme_minimal() + theme(legend.position = "bottom"))
options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis",
  digits = 3
)
scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```

##### In this fun explorations section, we discuss two interesting topics:
#####   1. What is the staff flu-vaccination rates in each county and how they may relate to the covid-19 confirmed cases in nursing homes each month according to the trend
#####   2. How may election results relate to the Covid-19 outcomes in nursing homes? <br></br>

## Staff Flu-Vaccination Rates in Each County (overview)
<br></br>
<center>![](./pictures/vaccination.jpg){width=70%}</center>
<br></br>

##### We have collected nursing home employees' flu-vaccination rates and use county as unit to make observations.
##### Following is an overview graph for each county:

```{r echo = FALSE, fig.align = 'center'}
data_df = read.csv("./data/overall_df.csv")

vacci_rate_graph =
  data_df %>%
    select(month, county, staff_flu_vaccination_rate, residents_covid19_cases_per_month) %>%
    drop_na(staff_flu_vaccination_rate) %>%
    mutate(
     county = fct_reorder(county, staff_flu_vaccination_rate)
    ) %>%
    ggplot(aes(x = county, y = staff_flu_vaccination_rate, color = staff_flu_vaccination_rate)) +
    geom_point(na.rm = T) +
    geom_line(na.rm = T) +
    labs(title = "Staff Flu-Vaccination Rate", x = "County", y = "Rate") +
    theme(
      axis.text.x = element_text(angle = 90, vjust = 0.6, hjust = 0.5),
      legend.position = "none",
      plot.title = element_text(hjust = 0.5, size = 15),
    )

vacci_rate_graph
```

##### We can observe that almost all counties' nursing home have >50% flu-vaccination rate for their employees except for Lewis and Franklin county (The lewis county may have wrong data input in flu-vaccination rate). A big trunk of county have >75% flu-vaccination rate. Yates, Clinton, and Greene ranks 1 to 3 in flu-vaccination rate correspondingly. <br></br>

## Staff-Vaccination rate vs NH residents' cases

##### We want to see the relationship between nursing home employees' flu-vaccination rates and the Covid-19 confirmed cases each month. Here is the plot showing this relationship during 2020.5 to 2020.10:
<br></br>

```{r echo = FALSE, fig.align = 'center'}
vacci_vs_cases =
  data_df %>%
  select(month, county, staff_flu_vaccination_rate, residents_covid19_cases_per_month) %>%
  drop_na(residents_covid19_cases_per_month) %>%
  ggplot(aes(x = staff_flu_vaccination_rate, y = residents_covid19_cases_per_month)) +
  geom_point(alpha = 0.6, color = "lightblue", na.rm = T) +
  labs(title = "Staff Flu-Vaccination Rate vs. Covid-19 Cases", x = "Rate", y = "Covid-19 Cases / Month", subtitle = "2020.5 - 2020.10") +
  theme(
    plot.title = element_text(hjust = 0.5, size = 15),
    plot.subtitle = element_text(hjust = 0.5))

vacci_vs_cases
```

##### As can see from the plot, most data points cluster in the bottom right corner, and as the flu-vaccination rate exceeds 87.5%, the confirmed covid-19 cases per month keeps stable under 125 cases. This may imply that higher employees' flu-vaccination rate may have a protective effect from covid-19 infection, but further analysis is conducted in regression analysis. Please see the analysis section in the website. <br></br>


```{r echo = FALSE, fig.align = 'center'}
facility_death_trend =
  data_df %>%
  select(month, county, total_shortage_stuff_monthly, ventilator_dependent_unit_monthly, NH_monthly_fatality_rate, total_supply_ppe_monthly) %>%
  drop_na(NH_monthly_fatality_rate)

facility_all =
  facility_death_trend %>%
  filter(total_shortage_stuff_monthly == 1, NH_monthly_fatality_rate < 1) %>%
  ggplot(aes(x = month, y = NH_monthly_fatality_rate, color = county, group = county)) +
  geom_point() +
  geom_line()
  
```

## How does election relate to the Covid-19 situations in nursing homes?

<br></br>
<center>![](./pictures/voting.jpg){width=70%}</center>
<br></br>

##### We separate counties into two democratic parties and then observe the nursing home monthly fatality rate. For the counties that have more support rate for republican party, their nursing home monthly fatality rate tend to be generally lower than that of the counties having more support rate for democratic party. Also, the republican winning counties have more density in 0% ~ 0.1% monthly fatality rate.
##### It is reasonable that for the counties which have higher monthly fatality rate in nursing homes, they may be insatisfied for the current covid-19 policy and tend to support an alternative political party(the democratic party). But there may exist many confounders if further analyze the relationship. For example, the democratic winning counties cluster in more developed areas instead of rural areas, therefore the education levels may be an significant confounder. More analysis is done in the analysis section in the website.

```{r echo = FALSE, fig.align = 'center'}
election_df =
  data_df %>%
  select(month, county, election_result, NH_monthly_fatality_rate) %>%
  filter(NH_monthly_fatality_rate < 1) %>%
  drop_na(NH_monthly_fatality_rate, election_result) %>%
  mutate(
    election_result = str_replace(election_result, "D", "Democratic wins county"),
    election_result = str_replace(election_result, "R", "Republican wins county")
  ) %>%
  ggplot(aes(x = NH_monthly_fatality_rate, fill = election_result)) +
  geom_density(alpha = 0.4, adjust = 0.5, color = "pink") +
  labs(x = "Nursing Home Monthly Fatality Rate", y = "Density", fill = "Election Result") +
  scale_fill_manual(values = c("skyblue", "pink"))

election_df
```

